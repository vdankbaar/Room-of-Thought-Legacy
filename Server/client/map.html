<html>
    <head>
        <link rel="stylesheet" type="text/css" href="map.css">
        <title>Map</title>
    </head>
    
    <body>
        <div id="board">
            <div id="tokens"></div>
            <svg id="polyBlockers" xmlns="http://www.w3.org/2000/svg"></svg>
            <div id="polyBlockerHandles"></div>
            <div id="newPolyBlockerHandles"></div>
            <div id="shapeHandles"></div>
            <div id="blockers"></div>
            <canvas id="antiBlockerMap"></canvas>
            <canvas id="shapeMap"></canvas>
            <canvas id="map"></canvas>
            <canvas id="hitboxMap"></canvas>
            <img id="hiddenMapLoader" width="0" height="0" src="">
            <ul id="contextMenu" class='custom-menu' oncontextmenu="event.preventDefault();"></ul>
            <ul id="subContextMenu" class='custom-menu' oncontextmenu="event.preventDefault();"></ul>
        </div>
        <div id="Resizer"></div>
        <div id="sideMenu">
            <div id="toggleButtons">
                <button id="toggleGridButton" title="Toggle Grid (G)"><object type="image/svg+xml" data="images/grid_on-24px.svg"></object></button>
                <button id="toggleSnapButton" title="Toggle Grid Snapping (S)"><object type="image/svg+xml" data="images/magnet-solid.svg"></object></button>
                <button id="toggleBlockerEditing" title="Edit blockers (B)" class="dmOnly"><object type="image/svg+xml" data="images/construction-24px.svg"></object></button>
                <button id="toggleSettingsButton" title="DM Settings" class="dmOnly"><object type="image/svg+xml" data="images/settings-24px.svg"></object></button>
            </div>
            <div id="mapOptionsMenu">
                <label for="mapSelect">Current map:</label>
                <select id="mapSelect"></select>
                <label for="mapSource">Current map image file:</label>
                <select id="mapSource"></select>
                <label for="gridColorPicker">Grid color:</label>
                <input type="color" id="gridColorPicker" value="#222222">
                <div id="optionsGridDisplay">
                    <label for="mapX">Grid X:<input type="number" id="mapX" step="0.1"></label>
                    <label for="mapY">Grid Y:<input type="number" id="mapY" step="0.1"></label>
                    <label for="offsetX">X offset:<input type="number" id="offsetX"></label>
                    <label for="offsetY">Y offset:<input type="number" id="offsetY"></label>
                </div>
                <input id="startAlignTool" class="dmOnly" type="button" value="Start Align Tool">
                <input id="importMap" class="dmOnly" type="button" value="Upload JSON file">
                <input id="exportMap" class="dmOnly" type="button" value="Export JSON file">
                <input id="hideInits" class="dmOnly" type="button" value="Hide/Reveal initiatives">
                <input id="clearTokensButton" class="dmOnly" type="button" value="Clear all tokens">
                <input id="clearDrawingsButton" class="dmOnly" type="button" value="Clear all drawings">
                <input id="clearBlockersButton" class="dmOnly" type="button" value="Clear all blockers">
                <input id="switchBlockerTypeButton" class="dmOnly" type="button" value="Switch blocker type">
                <input id="invertBlockerButton" class="dmOnly" type="button" value="Invert blockers">
            </div>
            <div id="notesEditor">
                <textarea placeholder="Enter your notes here..."></textarea>
            </div>
            <div id="bulkInitGeneratorScreen">
                <a>Bulk initiative generator</a>
                <label for="bulkTokenSelect">Token image:<select id="bulkTokenSelect"></select></label>
                <label for="bulkTokenNameInput">Common name:<input type="text" id="bulkTokenNameInput" autocomplete="off" spellcheck="false"></select></label>
                <label for="bulkTokenAmountInput">Tokens to place:<input type="number" id="bulkTokenAmountInput" value="1"></label>
                <input id="bulkTokenConfirm" type="button" value="Start placing">
            </div>
            <p style="margin: 0px; font-size: 1vw;">Draw Color:</p>
            <input type="color" id="shapeColorPicker">
            <div id="initiativeHeader">
                <h3>Initiative Tracker</h3>
                <input class="dmOnly" id="openBulkGenerator" type="button" value="+">
            </div>
            <input class="dmOnly" type="text" id="initSearch" placeholder="Search..." autocomplete="off" spellcheck="false">
            <div id="initiativeTracker">
            </div>
            <div id="detailsScreen" style="display: none;">
                <h3 style="grid-area: title; margin: 0px;"></h3>
                <div id="detailsIcon" title="Click to open notes!"><img></div>
                <img id="hitpointsIcon" title="Click here to deduct HP" type="image/svg+xml" src="images/favorite-24px.svg"></img>
                <div id="detailsHitpoints">
                    <input id="currentHitpoints" autocomplete="off" spellcheck="false">
                    <p>/</p>
                    <input id="maxHitpoints" autocomplete="off" spellcheck="false">
                </div>
                <object id="armorIcon" type="image/svg+xml" data="images/security-24px.svg"></object>
                <input id="armorClass" autocomplete="off" spellcheck="false">
                <p style="grid-area: name; margin: 0px;">Name:</p>
                <input type="text" id="detailsNameInput" autocomplete="off" spellcheck="false">
                <p style="grid-area: status; margin: 0px;">Status:</p>
                <input type="text" id="detailsStatusInput" autocomplete="off" spellcheck="false">
                <p style="grid-area: initiative; margin: 0px;">Initiative:</p>
                <p style="grid-area: group; margin: 0px;">Group:</p>
                <input type="text" id="detailsInitiative" class="detailsBottom" autocomplete="off" spellcheck="false">
                <input type="text" id="detailsGroup" class="detailsBottom" autocomplete="off" spellcheck="false">
            </div>
        </div>
        <script>
            let hbMap = document.getElementById("hitboxMap");
            function showHitmap() {
                hbMap.style.top = document.getElementById("map").clientHeight;
            }
            function hideHitmap() {
                hbMap.style.top = 0;
            }
        </script>
        <iframe style="display:none;" id="hiddenFrame"></iframe>
        <script type="module" src="map.js"></script>
        <form id="fileForm" style="visibility:hidden;" action='/upload' method='post' encType="multipart/form-data" target="hiddenFrame">
            <input id="fileImport" name="mapFile" type="file" accept=".json">
            <br>
            <input id="hiddenDMCheckbox" name="isDM" type="checkbox">
            <br>
            <input type="submit" id="submitMap">
        </form>
    </body>
</html>